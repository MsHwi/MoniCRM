<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DBRD2050">
    <!-- Search Marketing Process State(마케팅 진행 현황 조회) --> 
    <select id="SELECT_MRK_PRCS_STT" resultType="java.util.HashMap"  parameterType="java.util.HashMap">
        /* DBRD2050.SELECT_MRK_PRCS_STT : Search Marketing Process State(마케팅 진행 현황 조회) */        
        SELECT ISNULL(SUM(CASE WHEN MKT_TYP_CD = '01' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, -1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_YSTD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '01' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP})), 112),'-',''), ' ',''),':','')                   + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_TD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '01' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, +1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_TMRRW
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '02' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, -1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_YSTD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '02' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP})), 112),'-',''), ' ',''),':','')                   + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_TD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '02' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, +1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_TMRRW
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '03' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, -1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_YSTD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '03' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP})), 112),'-',''), ' ',''),':','')                   + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_TD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '03' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, +1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_TMRRW
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '04' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, -1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_YSTD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '04' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP})), 112),'-',''), ' ',''),':','')                   + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_TD
             , ISNULL(SUM(CASE WHEN MKT_TYP_CD = '04' AND REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, +1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') + '0001' BETWEEN MKT_STR_DT + MKT_STR_TM AND MKT_END_DT + MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_TMRRW     
             , REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, -1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') AS YSTDY
             , REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP})), 112),'-',''), ' ',''),':','') AS TODAY
             , REPLACE(REPLACE(REPLACE(CONVERT(VARCHAR(8), DATEADD(DAY, +1, CONVERT(DATE, dbo.FN_LOC_DT(#{GBL_UTC_GAP}))), 112),'-',''), ' ',''),':','') AS TMRRW
        FROM T_MKT_INFO WITH(NOLOCK)
       WHERE USE_YN = 'Y'         
    </select>
</mapper>