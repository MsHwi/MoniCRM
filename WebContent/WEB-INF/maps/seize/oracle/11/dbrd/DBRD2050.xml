<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DBRD2050">
    <!-- Search Marketing Process State(마케팅 진행 현황 조회) --> 
    <select id="SELECT_MRK_PRCS_STT" resultType="java.util.HashMap"  parameterType="java.util.HashMap">
        /* DBRD2050.SELECT_MRK_PRCS_STT : Search Marketing Process State(마케팅 진행 현황 조회) */
        SELECT NVL(SUM(CASE WHEN MKT_TYP_CD = '01' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') - 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_YSTD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '01' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD'), 'YYYYMMDD')     || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_TD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '01' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') + 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS GT_TMRRW
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '02' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') - 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_YSTD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '02' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD'), 'YYYYMMDD')     || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_TD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '02' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') + 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS EVNT_TMRRW
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '03' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') - 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_YSTD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '03' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD'), 'YYYYMMDD')     || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_TD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '03' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') + 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS SURV_TMRRW
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '04' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') - 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_YSTD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '04' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD'), 'YYYYMMDD')     || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_TD
             , NVL(SUM(CASE WHEN MKT_TYP_CD = '04' AND TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') + 1, 'YYYYMMDD') || '0001' BETWEEN MKT_STR_DT || MKT_STR_TM AND MKT_END_DT || MKT_END_TM THEN 1 ELSE 0 END), 0) AS CPN_TMRRW     
             , TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') - 1, 'YYYYMMDD') AS YSTDY
             , TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD'), 'YYYYMMDD') AS TODAY
             , TO_CHAR(TO_DATE(FN_LOC_DT(#{GBL_UTC_GAP}), 'YYYYMMDD') + 1, 'YYYYMMDD') AS TMRRW
        FROM T_MKT_INFO
        
       WHERE USE_YN = 'Y'        
    </select>
</mapper>